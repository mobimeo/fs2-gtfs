<!DOCTYPE html><html><head><title>fs2-gtfs Website: Writing to a GTFS file</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Mobimeo GmbH" /><meta name="description" content="fs2 based GTFS processing library" /><meta name="og:image" content="/fs2-gtfs/img/poster.png" /><meta name="image" property="og:image" content="/fs2-gtfs/img/poster.png" /><meta name="og:title" content="fs2-gtfs Website: Writing to a GTFS file" /><meta name="title" property="og:title" content="fs2-gtfs Website: Writing to a GTFS file" /><meta name="og:site_name" content="fs2-gtfs Website" /><meta name="og:url" content="https://github.com/mobimeo/fs2-gtfs" /><meta name="og:type" content="website" /><meta name="og:description" content="fs2 based GTFS processing library" /><link rel="icon" type="image/png" href="/fs2-gtfs/img/favicon.png" /><meta name="twitter:title" content="fs2-gtfs Website: Writing to a GTFS file" /><meta name="twitter:image" content="/fs2-gtfs/img/poster.png" /><meta name="twitter:description" content="fs2 based GTFS processing library" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@MobimeoMobility" /><link rel="icon" type="image/png" sizes="16x16" href="/fs2-gtfs/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/fs2-gtfs/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/fs2-gtfs/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/fs2-gtfs/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/fs2-gtfs/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/fs2-gtfs/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/fs2-gtfs/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/fs2-gtfs/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/fs2-gtfs/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/fs2-gtfs/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/fs2-gtfs/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/fs2-gtfs/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/fs2-gtfs/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/fs2-gtfs/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/fs2-gtfs/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/fs2-gtfs/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/fs2-gtfs/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/fs2-gtfs/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/fs2-gtfs/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/fs2-gtfs/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/fs2-gtfs/highlight/styles/vs.css" /><link rel="stylesheet" href="/fs2-gtfs/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/fs2-gtfs/" class="brand"><div class="brand-wrapper"></div><span>fs2-gtfs Website</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/fs2-gtfs/documentation/" title="Introduction" class="">Introduction</a></div> <div class="sidebar-nav-item  "><a href="/fs2-gtfs/documentation/model/" title="GTFS Data Model" class="">GTFS Data Model</a></div> <div class="sidebar-nav-item  open"><a href="/fs2-gtfs/documentation/file/" title="GTFS File" class="drop-nested">GTFS File</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/fs2-gtfs/documentation/file/reading/" title="Reading" class="">Reading</a> <a href="/fs2-gtfs/documentation/file/writing/" title="Writing" class="active">Writing</a></div></div> <div class="sidebar-nav-item  "><a href="/fs2-gtfs/documentation/rules/" title="GTFS Rule Engine" class="drop-nested">GTFS Rule Engine</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/fs2-gtfs/documentation/rules/dsl/" title="Rule DSL" class="">Rule DSL</a></div></div> <div class="sidebar-nav-item  "><a href="/fs2-gtfs/api/" title="API Documentation" class="">API Documentation</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/mobimeo/fs2-gtfs" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/mobimeo/fs2-gtfs" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="mobimeo" data-github-repo="fs2-gtfs"><div class="content-wrapper"><section><ul id="markdown-toc">
  <li><a href="#writing-to-a-gtfs-file" id="markdown-toc-writing-to-a-gtfs-file">Writing to a GTFS file</a>    <ul>
      <li><a href="#modifying-an-existing-file" id="markdown-toc-modifying-an-existing-file">Modifying an existing file</a></li>
      <li><a href="#creating-a-new-file" id="markdown-toc-creating-a-new-file">Creating a new file</a></li>
    </ul>
  </li>
</ul>

<h1 id="writing-to-a-gtfs-file">Writing to a GTFS file</h1>

<p>Similarly <a href="../reading/">reading GTFS file</a>, one can write GTFS files easily using this library. You can either modify an existing file, or create a new one from scratch.
The writing pipes, live in the <code class="language-plaintext highlighter-rouge">write</code> namespace within the <code class="language-plaintext highlighter-rouge">GtfsFile</code> class. This namespace provides a handful of <code class="language-plaintext highlighter-rouge">Pipe</code>s which give access to standard GTFS files.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.mobimeo.gtfs.file._</span>
<span class="k">import</span> <span class="nn">com.mobimeo.gtfs.model._</span>

<span class="k">import</span> <span class="nn">cats.effect._</span>
<span class="k">import</span> <span class="nn">cats.effect.unsafe.implicits.global</span>

<span class="k">import</span> <span class="nn">fs2.io.file.</span><span class="o">{</span><span class="nc">CopyFlag</span><span class="o">,</span> <span class="nc">CopyFlags</span><span class="o">,</span> <span class="nc">Path</span><span class="o">}</span>

<span class="k">val</span> <span class="nv">gtfs</span> <span class="k">=</span> <span class="nc">GtfsFile</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="nc">Path</span><span class="o">(</span><span class="s">"site/gtfs.zip"</span><span class="o">))</span>
<span class="c1">// gtfs: Resource[IO, GtfsFile[IO]] = Bind(</span>
<span class="c1">//   source = Allocate(</span>
<span class="c1">//     resource = cats.effect.kernel.Resource$$$Lambda$14773/0x000000080375b040@2931418</span>
<span class="c1">//   ),</span>
<span class="c1">//   fs = cats.effect.kernel.Resource$$Lambda$14775/0x0000000803791040@1e42fdd0</span>
<span class="c1">// )</span>
</code></pre></div></div>

<h2 id="modifying-an-existing-file">Modifying an existing file</h2>

<p>Oftentimes you already have an existing file in your hands and you want to modify it. To this end, you can pipe the read stream into the corresponding pipe.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">gtfs</span><span class="o">.</span><span class="py">use</span> <span class="o">{</span> <span class="n">gtfs</span> <span class="k">=&gt;</span>
  <span class="nv">gtfs</span><span class="o">.</span><span class="py">read</span>
    <span class="o">.</span><span class="py">rawStops</span>
    <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">s</span> <span class="k">=&gt;</span> <span class="nv">s</span><span class="o">.</span><span class="py">modify</span><span class="o">(</span><span class="s">"stop_name"</span><span class="o">)(</span><span class="nv">_</span><span class="o">.</span><span class="py">toUpperCase</span><span class="o">))</span>
    <span class="o">.</span><span class="py">through</span><span class="o">(</span><span class="nv">gtfs</span><span class="o">.</span><span class="py">write</span><span class="o">.</span><span class="py">rawStops</span><span class="o">)</span>
    <span class="o">.</span><span class="py">compile</span>
    <span class="o">.</span><span class="py">drain</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This code modifies the file in place, making all stop names uppercase. However this is usually not recommended as data are overwritten and original data are replaced.
One should prefer to work on a copy of the original file. The <code class="language-plaintext highlighter-rouge">GtfsFile</code> provides a way to do it conveniently.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">modified</span> <span class="k">=</span> <span class="nc">Path</span><span class="o">(</span><span class="s">"site/modified-gtfs.zip"</span><span class="o">)</span>
<span class="c1">// modified: Path = site/modified-gtfs.zip</span>
<span class="nv">gtfs</span><span class="o">.</span><span class="py">use</span> <span class="o">{</span> <span class="n">src</span> <span class="k">=&gt;</span>
  <span class="nv">src</span><span class="o">.</span><span class="py">copyTo</span><span class="o">(</span><span class="n">modified</span><span class="o">,</span> <span class="nc">CopyFlags</span><span class="o">(</span><span class="nv">CopyFlag</span><span class="o">.</span><span class="py">ReplaceExisting</span><span class="o">)).</span><span class="py">use</span> <span class="o">{</span> <span class="n">tgt</span> <span class="k">=&gt;</span>
    <span class="nv">src</span><span class="o">.</span><span class="py">read</span>
      <span class="o">.</span><span class="py">rawStops</span>
      <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">s</span> <span class="k">=&gt;</span> <span class="nv">s</span><span class="o">.</span><span class="py">modify</span><span class="o">(</span><span class="s">"stop_name"</span><span class="o">)(</span><span class="nv">_</span><span class="o">.</span><span class="py">toUpperCase</span><span class="o">))</span>
      <span class="o">.</span><span class="py">through</span><span class="o">(</span><span class="nv">tgt</span><span class="o">.</span><span class="py">write</span><span class="o">.</span><span class="py">rawStops</span><span class="o">)</span>
      <span class="o">.</span><span class="py">compile</span>
      <span class="o">.</span><span class="py">drain</span>
  <span class="o">}</span>
<span class="o">}.</span><span class="py">unsafeRunSync</span><span class="o">()</span>

<span class="k">def</span> <span class="nf">printStops</span><span class="o">(</span><span class="n">gtfs</span><span class="k">:</span> <span class="kt">GtfsFile</span><span class="o">[</span><span class="kt">IO</span><span class="o">])</span> <span class="k">=</span>
  <span class="nv">gtfs</span><span class="o">.</span><span class="py">read</span>
    <span class="o">.</span><span class="py">rawStops</span>
    <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">s</span> <span class="k">=&gt;</span> <span class="nf">s</span><span class="o">(</span><span class="s">"stop_name"</span><span class="o">))</span>
    <span class="o">.</span><span class="py">unNone</span>
    <span class="o">.</span><span class="py">take</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
    <span class="o">.</span><span class="py">intersperse</span><span class="o">(</span><span class="s">"\n"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">evalMap</span><span class="o">(</span><span class="n">s</span> <span class="k">=&gt;</span> <span class="nc">IO</span><span class="o">(</span><span class="nf">print</span><span class="o">(</span><span class="n">s</span><span class="o">)))</span>
    <span class="o">.</span><span class="py">compile</span>
    <span class="o">.</span><span class="py">drain</span>

<span class="c1">// original file</span>
<span class="nv">gtfs</span><span class="o">.</span><span class="py">use</span><span class="o">(</span><span class="nf">printStops</span><span class="o">(</span><span class="k">_</span><span class="o">)).</span><span class="py">unsafeRunSync</span><span class="o">()</span>
<span class="c1">// S+U Berlin Hauptbahnhof</span>
<span class="c1">// S+U Berlin Hauptbahnhof</span>
<span class="c1">// Berlin, Friedrich-Olbricht-Damm/Saatwinkler Damm</span>
<span class="c1">// Berlin, Stieffring</span>
<span class="c1">// Berlin, Lehrter Str./Invalidenstr.</span>

<span class="c1">// modified file</span>
<span class="nc">GtfsFile</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="n">modified</span><span class="o">).</span><span class="py">use</span><span class="o">(</span><span class="nf">printStops</span><span class="o">(</span><span class="k">_</span><span class="o">)).</span><span class="py">unsafeRunSync</span><span class="o">()</span>
<span class="c1">// S+U BERLIN HAUPTBAHNHOF</span>
<span class="c1">// S+U BERLIN HAUPTBAHNHOF</span>
<span class="c1">// BERLIN, FRIEDRICH-OLBRICHT-DAMM/SAATWINKLER DAMM</span>
<span class="c1">// BERLIN, STIEFFRING</span>
<span class="c1">// BERLIN, LEHRTER STR./INVALIDENSTR.</span>
</code></pre></div></div>

<p>When using <code class="language-plaintext highlighter-rouge">copyTo</code> the entirety of the original GTFS file content is copied and only files that are written to are modified. The rest is identical to the original file (including potential non standard files).</p>

<h2 id="creating-a-new-file">Creating a new file</h2>

<p>If one wants to create a new file from scratch, one need to tell the file needs to be created when creating the GTFS resource. An empty GTFS file will be created, and files can be added to it by using the associated <code class="language-plaintext highlighter-rouge">write</code> pipes.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">makeStop</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span>
  <span class="nc">Stop</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">Some</span><span class="o">(</span><span class="n">name</span><span class="o">),</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">None</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">file</span> <span class="k">=</span> <span class="nc">Path</span><span class="o">(</span><span class="s">"site/gtfs2.zip"</span><span class="o">)</span>
<span class="c1">// file: Path = site/gtfs2.zip</span>
<span class="nc">GtfsFile</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="n">file</span><span class="o">,</span> <span class="n">create</span> <span class="k">=</span> <span class="kc">true</span><span class="o">).</span><span class="py">use</span> <span class="o">{</span> <span class="n">gtfs</span> <span class="k">=&gt;</span>
  <span class="nv">fs2</span><span class="o">.</span><span class="py">Stream</span><span class="o">.</span><span class="py">emits</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="nf">makeStop</span><span class="o">(</span><span class="s">"stop1"</span><span class="o">,</span> <span class="s">"Some Stop"</span><span class="o">),</span> <span class="nf">makeStop</span><span class="o">(</span><span class="s">"stop2"</span><span class="o">,</span> <span class="s">"Some Other Stop"</span><span class="o">)))</span>
    <span class="o">.</span><span class="py">covary</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
    <span class="o">.</span><span class="py">through</span><span class="o">(</span><span class="nv">gtfs</span><span class="o">.</span><span class="py">write</span><span class="o">.</span><span class="py">stops</span><span class="o">[</span><span class="kt">Stop</span><span class="o">])</span>
    <span class="o">.</span><span class="py">compile</span>
    <span class="o">.</span><span class="py">drain</span>
<span class="o">}.</span><span class="py">unsafeRunSync</span><span class="o">()</span>

<span class="nc">GtfsFile</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="n">file</span><span class="o">).</span><span class="py">use</span><span class="o">(</span><span class="nf">printStops</span><span class="o">(</span><span class="k">_</span><span class="o">)).</span><span class="py">unsafeRunSync</span><span class="o">()</span>
<span class="c1">// Some Stop</span>
<span class="c1">// Some Other Stop</span>
</code></pre></div></div>

</section></div></div></div></div><script src="/fs2-gtfs/highlight/highlight.pack.js"></script><script src="/fs2-gtfs/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/fs2-gtfs/js/search.js"></script><script src="/fs2-gtfs/js/docs.js"></script></body></html>