<!DOCTYPE html><html><head><title>fs2-gtfs Website: External DSL</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Mobimeo GmbH" /><meta name="description" content="fs2 based GTFS processing library" /><meta name="og:image" content="/fs2-gtfs/img/poster.png" /><meta name="image" property="og:image" content="/fs2-gtfs/img/poster.png" /><meta name="og:title" content="fs2-gtfs Website: External DSL" /><meta name="title" property="og:title" content="fs2-gtfs Website: External DSL" /><meta name="og:site_name" content="fs2-gtfs Website" /><meta name="og:url" content="https://github.com/mobimeo/fs2-gtfs" /><meta name="og:type" content="website" /><meta name="og:description" content="fs2 based GTFS processing library" /><link rel="icon" type="image/png" href="/fs2-gtfs/img/favicon.png" /><meta name="twitter:title" content="fs2-gtfs Website: External DSL" /><meta name="twitter:image" content="/fs2-gtfs/img/poster.png" /><meta name="twitter:description" content="fs2 based GTFS processing library" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@MobimeoMobility" /><link rel="icon" type="image/png" sizes="16x16" href="/fs2-gtfs/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/fs2-gtfs/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/fs2-gtfs/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/fs2-gtfs/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/fs2-gtfs/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/fs2-gtfs/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/fs2-gtfs/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/fs2-gtfs/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/fs2-gtfs/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/fs2-gtfs/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/fs2-gtfs/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/fs2-gtfs/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/fs2-gtfs/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/fs2-gtfs/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/fs2-gtfs/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/fs2-gtfs/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/fs2-gtfs/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/fs2-gtfs/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/fs2-gtfs/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/fs2-gtfs/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/fs2-gtfs/highlight/styles/vs.css" /><link rel="stylesheet" href="/fs2-gtfs/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/fs2-gtfs/" class="brand"><div class="brand-wrapper"></div><span>fs2-gtfs Website</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/fs2-gtfs/documentation/" title="Introduction" class="">Introduction</a></div> <div class="sidebar-nav-item  "><a href="/fs2-gtfs/documentation/model/" title="GTFS Data Model" class="">GTFS Data Model</a></div> <div class="sidebar-nav-item  "><a href="/fs2-gtfs/documentation/file/" title="GTFS File" class="drop-nested">GTFS File</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/fs2-gtfs/documentation/file/reading/" title="Reading" class="">Reading</a> <a href="/fs2-gtfs/documentation/file/writing/" title="Writing" class="">Writing</a></div></div> <div class="sidebar-nav-item  open"><a href="/fs2-gtfs/documentation/rules/" title="GTFS Rule Engine" class="drop-nested">GTFS Rule Engine</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/fs2-gtfs/documentation/rules/dsl/embedded/" title="Embedded DSL" class="">Embedded DSL</a> <a href="/fs2-gtfs/documentation/rules/dsl/external/" title="External DSL" class="active">External DSL</a></div></div> <div class="sidebar-nav-item  "><a href="/fs2-gtfs/api/" title="API Documentation" class="">API Documentation</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/mobimeo/fs2-gtfs" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/mobimeo/fs2-gtfs" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="mobimeo" data-github-repo="fs2-gtfs"><div class="content-wrapper"><section><ul id="markdown-toc">
  <li><a href="#the-external-dsl" id="markdown-toc-the-external-dsl">The external DSL</a>    <ul>
      <li><a href="#the-dsl-syntax" id="markdown-toc-the-dsl-syntax">The DSL syntax</a></li>
      <li><a href="#parsing-the-dsl" id="markdown-toc-parsing-the-dsl">Parsing the DSL</a>        <ul>
          <li><a href="#using-the-ruleparser-class-directly" id="markdown-toc-using-the-ruleparser-class-directly">Using the <code class="language-plaintext highlighter-rouge">RuleParser</code> class directly</a>            <ul>
              <li><a href="#error-reporting" id="markdown-toc-error-reporting">Error reporting</a></li>
            </ul>
          </li>
          <li><a href="#using-the-interpolators" id="markdown-toc-using-the-interpolators">Using the interpolators</a>            <ul>
              <li><a href="#error-reporting-1" id="markdown-toc-error-reporting-1">Error reporting</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#pretty-printing" id="markdown-toc-pretty-printing">Pretty printing</a></li>
    </ul>
  </li>
</ul>

<h1 id="the-external-dsl">The external DSL</h1>

<p><a href="https://mvnrepository.com/artifact/com.mobimeo/fs2-gtfs-rules-syntax_2.13"><img src="https://img.shields.io/maven-central/v/com.mobimeo/fs2-gtfs-rules-syntax_2.13.svg" alt="Maven Central" /></a></p>

<p>To use the GTFS rule syntax, add the dependency to your build file. For instance for sbt:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"com.mobimeo"</span> <span class="o">%%</span> <span class="s">"fs2-gtfs-rules-syntax"</span> <span class="o">%</span> <span class="s">"&lt;version&gt;"</span>
</code></pre></div></div>

<p>It is cross compiled for scala 2.13 and scala 3.</p>

<p>The external DSL allows you to write rules in a declarative way without any knowledge of scala. This can be useful if you intend to have non developer to write the rules, or if you want to store them in a text file or database, without needing to compile scala code when they are changed.</p>

<h2 id="the-dsl-syntax">The DSL syntax</h2>

<p>The DSL syntax follows the following grammar.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">file</span> <span class="o">=</span> <span class="n">ruleset</span><span class="o">*</span>

<span class="n">ruleset</span> <span class="o">=</span> <span class="s1">'ruleset'</span> <span class="s1">'for'</span> <span class="n">filename</span> <span class="s1">'{'</span> <span class="n">rule</span> <span class="p">(</span><span class="s1">'or'</span> <span class="n">rule</span><span class="p">)</span><span class="o">*</span> <span class="s1">'}'</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s1">'agency'</span>
         <span class="o">|</span> <span class="s1">'stops'</span>
         <span class="o">|</span> <span class="s1">'routes'</span>
         <span class="o">|</span> <span class="s1">'trips'</span>
         <span class="o">|</span> <span class="s1">'stop_times'</span>
         <span class="o">|</span> <span class="s1">'calendar'</span>
         <span class="o">|</span> <span class="s1">'calendar_dates'</span>
         <span class="o">|</span> <span class="s1">'fare_attributes'</span>
         <span class="o">|</span> <span class="s1">'fare_rules'</span>
         <span class="o">|</span> <span class="s1">'shapes'</span>
         <span class="o">|</span> <span class="s1">'frequencies'</span>
         <span class="o">|</span> <span class="s1">'transfers'</span>
         <span class="o">|</span> <span class="s1">'pathways'</span>
         <span class="o">|</span> <span class="s1">'levels'</span>
         <span class="o">|</span> <span class="s1">'feed_info'</span>
         <span class="o">|</span> <span class="s1">'translations'</span>
         <span class="o">|</span> <span class="s1">'attributions'</span>

<span class="n">rule</span> <span class="o">=</span> <span class="s1">'rule'</span> <span class="n">ident</span> <span class="s1">'{'</span> <span class="s1">'when'</span> <span class="n">matcher</span> <span class="s1">'then'</span> <span class="n">action</span> <span class="s1">'}'</span>

<span class="n">matcher</span> <span class="o">=</span> <span class="s1">'('</span> <span class="n">matcher</span> <span class="s1">')'</span>
        <span class="o">|</span> <span class="s1">'!'</span> <span class="n">matcher</span>
        <span class="o">|</span> <span class="s1">'any'</span>
        <span class="o">|</span> <span class="n">variable</span> <span class="s1">'exists'</span>
        <span class="o">|</span> <span class="n">value</span> <span class="n">valueMatcher</span>
        <span class="o">|</span> <span class="n">matcher</span> <span class="s1">'and'</span> <span class="n">matcher</span>
        <span class="o">|</span> <span class="n">matcher</span> <span class="s1">'or'</span> <span class="n">matcher</span>

<span class="n">valueMatcher</span> <span class="o">=</span> <span class="s1">'=='</span> <span class="n">value</span>
             <span class="o">|</span> <span class="s1">'in'</span> <span class="s1">'['</span> <span class="n">value</span><span class="o">*</span> <span class="s1">']'</span>
             <span class="o">|</span> <span class="s1">'matches'</span> <span class="n">regex</span>

<span class="n">action</span> <span class="o">=</span> <span class="s1">'delete'</span>
       <span class="o">|</span> <span class="n">transformation</span> <span class="p">(</span><span class="s1">'then'</span> <span class="n">transformation</span><span class="p">)</span><span class="o">*</span>
       <span class="o">|</span> <span class="n">log</span>

<span class="n">transformation</span> <span class="o">=</span> <span class="s1">'set'</span> <span class="s1">'row'</span> <span class="s1">'['</span> <span class="n">str</span> <span class="s1">']'</span> <span class="s1">'to'</span> <span class="n">value</span>
               <span class="o">|</span> <span class="s1">'search'</span> <span class="n">regex</span> <span class="s1">'in'</span> <span class="s1">'row'</span> <span class="s1">'['</span> <span class="n">str</span> <span class="s1">']'</span> <span class="s1">'and'</span> <span class="s1">'replace'</span> <span class="s1">'by'</span> <span class="n">value</span>

<span class="n">log</span> <span class="o">=</span> <span class="s1">'debug'</span> <span class="s1">'('</span> <span class="n">expr</span> <span class="s1">')'</span>
    <span class="o">|</span> <span class="s1">'info'</span> <span class="s1">'('</span> <span class="n">expr</span> <span class="s1">')'</span>
    <span class="o">|</span> <span class="s1">'warning'</span> <span class="s1">'('</span> <span class="n">expr</span> <span class="s1">')'</span>
    <span class="o">|</span> <span class="s1">'error'</span> <span class="s1">'('</span> <span class="n">expr</span> <span class="s1">')'</span>

<span class="n">expr</span> <span class="o">=</span> <span class="n">ident</span> <span class="s1">'('</span> <span class="p">(</span><span class="n">expr</span> <span class="p">(</span><span class="s1">','</span> <span class="n">expr</span><span class="p">)</span><span class="o">*</span><span class="p">)?</span> <span class="s1">')'</span>
     <span class="o">|</span> <span class="n">value</span>
     <span class="o">|</span> <span class="n">expr</span> <span class="o">+</span> <span class="n">expr</span>

<span class="n">value</span> <span class="o">=</span> <span class="n">str</span>
      <span class="o">|</span> <span class="n">variable</span>

<span class="n">variable</span> <span class="o">=</span> <span class="s1">'row'</span> <span class="s1">'['</span> <span class="n">value</span> <span class="s1">']'</span>
         <span class="o">|</span> <span class="s1">'ctx'</span> <span class="s1">'['</span> <span class="n">value</span> <span class="s1">']'</span> <span class="p">(</span><span class="s1">'['</span> <span class="n">value</span> <span class="s1">']'</span><span class="p">)</span><span class="o">*</span>

<span class="n">ident</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="no">Z</span><span class="p">]</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="no">Z0</span><span class="o">-</span><span class="mi">9</span><span class="n">_</span><span class="o">-</span><span class="p">]</span><span class="o">*</span>
<span class="n">str</span> <span class="o">=</span> <span class="s1">'"'</span> <span class="o">&lt;</span><span class="n">any</span> <span class="n">character</span> <span class="n">with</span> <span class="s2">" and </span><span class="se">\ </span><span class="s2">escaped&gt; '"</span><span class="s1">'
regex = '</span><span class="o">/</span><span class="s1">' &lt;any character with / and \ escaped&gt; '</span><span class="o">/</span><span class="err">'</span>
</code></pre></div></div>

<p>Matcher operators have the following precedence: <code class="language-plaintext highlighter-rouge">!</code> has precedence over <code class="language-plaintext highlighter-rouge">and</code> which as precedence over <code class="language-plaintext highlighter-rouge">or</code>. This means that <code class="language-plaintext highlighter-rouge">!m1 and m2 or m3</code> is equivalent to <code class="language-plaintext highlighter-rouge">((!m1) and m2) or m3</code>.</p>

<p>Combinators are left associative, i.e. <code class="language-plaintext highlighter-rouge">m1 and m2 and m3</code> is equivalent to <code class="language-plaintext highlighter-rouge">(m1 and m2) and m3</code>.</p>

<h2 id="parsing-the-dsl">Parsing the DSL</h2>

<p>There are two way to parse rules written with the external DSL:</p>
<ol>
  <li>Using the <code class="language-plaintext highlighter-rouge">RuleParser</code> combinators from the <code class="language-plaintext highlighter-rouge">com.mobimeo.gtfs.rules.syntax</code> package.</li>
  <li>Using the string interpolators provided in the <code class="language-plaintext highlighter-rouge">com.mobimeo.gtfs.rules.syntax.lexicals</code> package.</li>
</ol>

<p><strong>Note:</strong> Rules parsed with the external DSL are effect free, only rules with <a href="https://typelevel.org/cats/api/cats/index.html#Id[A]=A"><code class="language-plaintext highlighter-rouge">Id</code></a> are generated. The effectful rules only come from the ones using anonymous scala functions, which cannot be expressed with the DSL.</p>

<h3 id="using-the-ruleparser-class-directly">Using the <code class="language-plaintext highlighter-rouge">RuleParser</code> class directly</h3>

<p>The parser is based on <a href="https://github.com/typelevel/cats-parse">cats-parse</a> and exposes different entry points to parse</p>
<ul>
  <li>a <code class="language-plaintext highlighter-rouge">file</code> which consists of zero or more rule sets,</li>
  <li>a <code class="language-plaintext highlighter-rouge">ruleset</code> which defines a single set of rules,</li>
  <li>a <code class="language-plaintext highlighter-rouge">rule</code> which defines a single rule.</li>
</ul>

<p>For instance, you can express the rule that makes stop names uppercase as follows:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.mobimeo.gtfs.rules.syntax._</span>

<span class="nv">RuleParser</span><span class="o">.</span><span class="py">ruleset</span><span class="o">.</span><span class="py">parseAll</span><span class="o">(</span><span class="s">"""ruleset for stops {
                              |  rule uppercase-stops {
                              |    when row["stop_name"] exists
                              |    then set row["stop_name"] to uppercase(row["stop_name"])
                              |  }
                              |}"""</span><span class="o">.</span><span class="py">stripMargin</span><span class="o">)</span>
<span class="c1">// res0: Either[cats.parse.Parser.Error, com.mobimeo.gtfs.rules.RuleSet[cats.package.Id]] = Right(</span>
<span class="c1">//   value = RuleSet(</span>
<span class="c1">//     file = "stops.txt",</span>
<span class="c1">//     rules = List(</span>
<span class="c1">//       Rule(</span>
<span class="c1">//         name = "uppercase-stops",</span>
<span class="c1">//         matcher = Exists(variable = Field(name = Str(value = "stop_name"))),</span>
<span class="c1">//         action = Transform(</span>
<span class="c1">//           transformations = NonEmptyList(</span>
<span class="c1">//             head = Set(</span>
<span class="c1">//               field = Str(value = "stop_name"),</span>
<span class="c1">//               to = NamedFunction(</span>
<span class="c1">//                 name = "uppercase",</span>
<span class="c1">//                 args = List(Val(v = Field(name = Str(value = "stop_name"))))</span>
<span class="c1">//               )</span>
<span class="c1">//             ),</span>
<span class="c1">//             tail = List()</span>
<span class="c1">//           )</span>
<span class="c1">//         )</span>
<span class="c1">//       )</span>
<span class="c1">//     ),</span>
<span class="c1">//     additions = List()</span>
<span class="c1">//   )</span>
<span class="c1">// )</span>
</code></pre></div></div>

<h4 id="error-reporting">Error reporting</h4>

<p><code class="language-plaintext highlighter-rouge">cats-parse</code> does not (yet) provide a nice pretty printing for parse errors, but we provide a module that can be used to render them nicely, namely the <code class="language-plaintext highlighter-rouge">Prettyprint</code> class.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.syntax.all._</span>

<span class="k">val</span> <span class="nv">input</span> <span class="k">=</span> <span class="s">"""rule wrong-uppercase-stops {
              |  when row["stop_name"] exist
              |  then set row["stop_name"] to uppercase(row["stop_name"])
              |}"""</span><span class="o">.</span><span class="py">stripMargin</span>
<span class="c1">// input: String = """rule wrong-uppercase-stops {</span>
<span class="c1">//   when row["stop_name"] exist</span>
<span class="c1">//   then set row["stop_name"] to uppercase(row["stop_name"])</span>
<span class="c1">// }"""</span>

<span class="nv">RuleParser</span><span class="o">.</span><span class="py">rule</span><span class="o">.</span><span class="py">parseAll</span><span class="o">(</span><span class="n">input</span><span class="o">).</span><span class="py">leftMap</span><span class="o">(</span><span class="n">error</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">Prettyprint</span><span class="o">(</span><span class="n">input</span><span class="o">).</span><span class="py">prettyprint</span><span class="o">(</span><span class="n">error</span><span class="o">))</span>
<span class="c1">// res1: Either[String, com.mobimeo.gtfs.rules.Rule[cats.package.Id]] = Left(</span>
<span class="c1">//   value = """</span>
<span class="c1">// 2:25: error: expected one of '==', 'exists', 'in', 'matches'</span>
<span class="c1">// 2 |   when row["stop_name"] exist</span>
<span class="c1">//   |                         ^"""</span>
<span class="c1">// )</span>
</code></pre></div></div>

<h3 id="using-the-interpolators">Using the interpolators</h3>

<p>When the rules you want to parse are known at compile time and you would like to be notified of syntax errors at compile time, you can use the provided interpolators from package <code class="language-plaintext highlighter-rouge">com.mobimeo.gtfs.rules.syntax.literals</code>.
The rules defined with these literals are parsed and checked at compile time, and they return the rules themselves, no wrapped in any <code class="language-plaintext highlighter-rouge">Either</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.mobimeo.gtfs.rules.syntax.literals._</span>

<span class="k">val</span> <span class="nv">rules</span> <span class="k">=</span>
  <span class="n">ruleset</span><span class="s">"""ruleset for stops {
              rule uppercase-stops {
                when row["stop_name"] exists
                then set row["stop_name"] to uppercase(row["stop_name"])
              }
           }"""</span>
<span class="c1">// rules: com.mobimeo.gtfs.rules.RuleSet[cats.package.Id] = RuleSet(</span>
<span class="c1">//   file = "stops.txt",</span>
<span class="c1">//   rules = List(</span>
<span class="c1">//     Rule(</span>
<span class="c1">//       name = "uppercase-stops",</span>
<span class="c1">//       matcher = Exists(variable = Field(name = Str(value = "stop_name"))),</span>
<span class="c1">//       action = Transform(</span>
<span class="c1">//         transformations = NonEmptyList(</span>
<span class="c1">//           head = Set(</span>
<span class="c1">//             field = Str(value = "stop_name"),</span>
<span class="c1">//             to = NamedFunction(</span>
<span class="c1">//               name = "uppercase",</span>
<span class="c1">//               args = List(Val(v = Field(name = Str(value = "stop_name"))))</span>
<span class="c1">//             )</span>
<span class="c1">//           ),</span>
<span class="c1">//           tail = List()</span>
<span class="c1">//         )</span>
<span class="c1">//       )</span>
<span class="c1">//     )</span>
<span class="c1">//   ),</span>
<span class="c1">//   additions = List()</span>
<span class="c1">// )</span>
</code></pre></div></div>

<h4 id="error-reporting-1">Error reporting</h4>

<p>Since rules are parsed at compile time, error reporting occurs when compiling the scala code in the scala compiler.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rule</span><span class="s">"""rule wrong-uppercase-stops {
         when row["stop_name"] exist
         then set row["stop_name"] to uppercase(row["stop_name"])
       }"""</span>
<span class="c1">// error:</span>
<span class="c1">// 2:32: error: expected one of '==', 'exists', 'in', 'matches'</span>
<span class="c1">// 2 |          when row["stop_name"] exist</span>
<span class="c1">//   |                                ^</span>
<span class="c1">// rule"""rule wrong-uppercase-stops {</span>
<span class="c1">// ^</span>
</code></pre></div></div>

<p>The code snippet above does not compile at all.</p>

<h2 id="pretty-printing">Pretty printing</h2>

<p>If you have set of rules that you’d like to serialize to the concrete syntax, you can use the <code class="language-plaintext highlighter-rouge">Show</code> instances available in the <code class="language-plaintext highlighter-rouge">com.mobimeo.gtfs.rules.syntax.pretty</code> package.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.mobimeo.gtfs.rules.syntax.pretty._</span>

<span class="nv">rules</span><span class="o">.</span><span class="py">show</span>
<span class="c1">// res3: String = """ruleset for stops {</span>
<span class="c1">//   rule uppercase-stops {</span>
<span class="c1">//     when row["stop_name"] exists</span>
<span class="c1">//     then set row["stop_name"] to uppercase(row["stop_name"])</span>
<span class="c1">//   }</span>
<span class="c1">// }"""</span>
</code></pre></div></div>

<p><strong>Note:</strong> the concrete syntax does not allow for expressing anonymous functions. If you try to serialize rules containing calls to anonymous functions, it will be rendered as concatenation of the arguments.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.Id</span>
<span class="k">import</span> <span class="nn">com.mobimeo.gtfs.rules._</span>

<span class="k">val</span> <span class="nv">fun</span> <span class="k">=</span> <span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">=&gt;</span> <span class="nv">s</span><span class="o">.</span><span class="py">mkString</span><span class="o">(</span><span class="s">"-"</span><span class="o">)</span>
<span class="c1">// fun: List[String] =&gt; String = &lt;function1&gt;</span>

<span class="k">val</span> <span class="nv">t</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">[</span><span class="kt">Id</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Expr</span><span class="o">.</span><span class="py">AnonymousFunction</span><span class="o">[</span><span class="kt">Id</span><span class="o">](</span><span class="n">fun</span><span class="o">,</span>
  <span class="nc">List</span><span class="o">(</span>
    <span class="nv">Expr</span><span class="o">.</span><span class="py">Val</span><span class="o">(</span><span class="nv">Value</span><span class="o">.</span><span class="py">Str</span><span class="o">(</span><span class="s">"a"</span><span class="o">)),</span>
    <span class="nv">Expr</span><span class="o">.</span><span class="py">Val</span><span class="o">(</span><span class="nv">Value</span><span class="o">.</span><span class="py">Str</span><span class="o">(</span><span class="s">"b"</span><span class="o">)),</span>
    <span class="nv">Expr</span><span class="o">.</span><span class="py">Val</span><span class="o">(</span><span class="nv">Value</span><span class="o">.</span><span class="py">Str</span><span class="o">(</span><span class="s">"c"</span><span class="o">))))</span>
<span class="c1">// t: Expr[Id] = AnonymousFunction(</span>
<span class="c1">//   f = &lt;function1&gt;,</span>
<span class="c1">//   args = List(</span>
<span class="c1">//     Val(v = Str(value = "a")),</span>
<span class="c1">//     Val(v = Str(value = "b")),</span>
<span class="c1">//     Val(v = Str(value = "c"))</span>
<span class="c1">//   )</span>
<span class="c1">// )</span>

<span class="nv">t</span><span class="o">.</span><span class="py">show</span>
<span class="c1">// res4: String = "\"a\" + \"b\" + \"c\""</span>
</code></pre></div></div>

</section></div></div></div></div><script src="/fs2-gtfs/highlight/highlight.pack.js"></script><script src="/fs2-gtfs/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/fs2-gtfs/js/search.js"></script><script src="/fs2-gtfs/js/docs.js"></script></body></html>